<!DOCTYPE html>
<html lang="fr">
  {% include head.html %}
  <body>
    <a class="skip-link" href="#main">Aller au contenu</a>
    <nav>{% include nav.html %}</nav>
    <div class="wrapper">
      <main id="main">{{ content }}</main>
      {% include footer.html %}
    </div>

    {% include link-previews.html wrapperQuerySelector=".note-content" %}

    <script>
    // Theme toggle: cycles auto ‚Üí dark ‚Üí light ‚Üí auto
    (function() {
      var root = document.documentElement;
      var btn = document.getElementById('theme-toggle');
      var icon = document.getElementById('theme-icon');
      if (!btn || !icon) return;

      var saved = localStorage.getItem('theme');
      if (saved === 'dark' || saved === 'light') {
        root.setAttribute('data-theme', saved);
      }
      updateIcon();

      btn.addEventListener('click', function() {
        var current = root.getAttribute('data-theme');
        if (!current) {
          // Was auto (OS) ‚Üí force dark
          root.setAttribute('data-theme', 'dark');
          localStorage.setItem('theme', 'dark');
        } else if (current === 'dark') {
          root.setAttribute('data-theme', 'light');
          localStorage.setItem('theme', 'light');
        } else {
          // Was light ‚Üí back to auto
          root.removeAttribute('data-theme');
          localStorage.removeItem('theme');
        }
        updateIcon();
      });

      function updateIcon() {
        var theme = root.getAttribute('data-theme');
        if (theme === 'dark') {
          icon.textContent = '‚òÄÔ∏è';
        } else if (theme === 'light') {
          icon.textContent = 'üåô';
        } else {
          // Auto ‚Äî show based on OS
          icon.textContent = window.matchMedia('(prefers-color-scheme: dark)').matches ? '‚òÄÔ∏è' : 'üåô';
        }
      }
    })();
    </script>
  </body>
</html>
